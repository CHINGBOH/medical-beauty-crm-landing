# 企业微信接入完整指南

**深圳妍美医疗美容门诊部 - 智能营销管理系统**

**文档版本：** v1.0  
**最后更新：** 2026-02-03  
**作者：** Manus AI

---

## 目录

1. [方案概述](#方案概述)
2. [为什么选择企业微信](#为什么选择企业微信)
3. [核心功能介绍](#核心功能介绍)
4. [技术架构设计](#技术架构设计)
5. [开发实施指南](#开发实施指南)
6. [使用场景示例](#使用场景示例)
7. [常见问题解答](#常见问题解答)
8. [参考资料](#参考资料)

---

## 方案概述

本文档为深圳妍美医疗美容门诊部的智能营销管理系统提供企业微信接入的完整解决方案。企业微信作为腾讯推出的企业级通讯工具，为医美行业提供了专业的客户联系和管理能力，特别是其**临时会话模式**专为医疗行业设计，完美契合医美诊所的业务需求。

通过接入企业微信，系统将实现以下核心能力：客户通过扫描二维码添加企业员工，在企业微信中进行咨询和预约；系统自动记录客户信息和对话历史，并同步到CRM数据库；根据客户行为和时间节点，自动推送营销内容和预约提醒；管理员可以在Web管理后台统一管理客户、配置推送规则、查看数据统计。

---

## 为什么选择企业微信

### 医疗行业专属优势

企业微信为医疗行业提供了**临时会话模式**，这是其他平台所不具备的独特功能。在这种模式下，客户扫描二维码后仅在指定时间内（如24小时）可以与企业员工进行会话，会话结束后系统会自动发送预设的结束语（如预约链接、优惠信息）。这种设计既保护了客户隐私，又确保了咨询的时效性，完全符合医疗行业的监管要求。

根据企业微信官方文档[1]，临时会话模式具有以下特点：二维码添加后立即失效，防止被恶意传播；会话有效期最长14天，可根据业务需求灵活配置；支持自定义结束语，可发送文本、图片、链接或小程序卡片；每日最多添加10万个临时会话，满足大规模营销需求。

### 与微信小程序的对比

| 对比维度 | 企业微信 | 微信小程序 |
|---------|---------|-----------|
| **开发成本** | 低（仅需对接API） | 高（需开发完整小程序） |
| **客户体验** | 优（无需安装，直接在企业微信中使用） | 一般（需要搜索或扫码进入） |
| **客户关系维护** | 强（员工可长期维护客户关系） | 弱（客户离开小程序后难以触达） |
| **消息推送** | 强（可主动推送营销内容） | 弱（需要客户订阅模板消息） |
| **数据统计** | 完善（客户添加、会话次数、转化率） | 基础（访问量、用户行为） |
| **医疗行业支持** | 优（临时会话模式） | 一般（无特殊支持） |
| **适用场景** | 客户咨询、关系维护、营销推送 | 在线预约、内容展示、会员管理 |

### 业务价值

接入企业微信将为深圳妍美医疗美容门诊部带来显著的业务价值。首先，**提升客户转化率**：客户扫码后可立即与专业顾问沟通，缩短决策路径，根据行业数据，企业微信的客户转化率比传统电话咨询高30%以上。其次，**降低运营成本**：通过自动化消息推送和客户标签管理，减少人工跟进成本，一个顾问可以同时维护数百位客户。第三，**提高客户满意度**：客户可以随时在企业微信中查看历史对话记录，获取项目信息和预约提醒，提升服务体验。最后，**数据驱动决策**：系统自动记录客户来源、咨询内容、转化路径等数据，为营销策略优化提供依据。

---

## 核心功能介绍

### 1. 客户联系功能

客户联系功能是企业微信的核心能力，允许企业员工添加客户为好友，并在企业微信中进行长期沟通。与个人微信不同，企业微信的客户联系功能提供了丰富的管理和统计能力，所有客户数据归属于企业而非个人员工，确保了客户资产的安全性。

#### 1.1 「联系我」二维码

「联系我」是企业微信提供的客户获取工具，企业可以生成专属的二维码或小程序按钮，客户扫描后即可添加企业员工。根据企业微信官方文档[1]，每个企业最多可以配置50万个「联系我」，临时会话模式不占用此配额，但每日最多添加10万个。

在CRM管理后台，管理员可以创建「联系我」二维码，配置以下参数：**联系方式类型**（单人或多人），单人模式下客户只能添加指定的一个员工，多人模式下系统会自动分配；**场景**（小程序中联系或二维码联系），小程序场景需要接入企业微信小程序插件；**临时会话模式**（是否启用），启用后客户添加后仅在指定时间内可会话；**有效期**（二维码和会话的有效期），最长14天；**渠道标识**（state参数），用于区分不同的营销渠道，如"xiaohongshu"、"douyin"、"pengyouquan"；**结束语**（会话结束时自动发送的消息），可以是文本、图片、链接或小程序卡片。

生成二维码后，系统会返回`config_id`和`qr_code`两个关键参数。`config_id`是配置的唯一标识，必须妥善保存，丢失后将无法编辑或删除该「联系我」。`qr_code`是二维码的图片URL，可以直接在营销物料中使用。

#### 1.2 客户详情获取

当客户添加企业员工后，系统可以通过API获取客户的详细信息。根据企业微信官方文档[2]，客户详情包括以下字段：**基本信息**（姓名、头像、性别、unionid），unionid可以与微信公众号或小程序的用户关联；**添加信息**（添加方式、添加时间、渠道标识），add_way字段表示客户是通过扫码、搜索手机号还是名片分享添加的，state字段是创建「联系我」时配置的渠道标识；**跟进信息**（跟进人员工ID、备注、描述、标签），企业员工可以为客户添加备注和标签，方便后续管理。

系统会在客户添加时自动调用此API，将客户信息同步到CRM数据库，并创建对应的线索记录。如果客户的unionid已经存在于数据库中，系统会自动关联历史记录，实现客户数据的统一管理。

### 2. 消息推送功能

企业微信支持向客户主动推送消息，这是其相比微信小程序的重要优势。根据企业微信官方文档[3]，支持的消息类型包括：**文本消息**（纯文本内容，最多2048个字符）；**图片消息**（需先上传图片到企业微信素材库）；**图文消息**（包含标题、描述、图片和链接，类似公众号图文）；**小程序卡片**（可以跳转到小程序页面）；**文件消息**（支持PDF、Word等文件格式）。

在CRM管理后台，管理员可以创建消息推送任务，选择目标客户（单个、批量或通过筛选条件），编辑消息内容，设置推送时间（立即或定时）。系统会自动调用企业微信API发送消息，并记录推送日志和效果数据（如打开率、点击率）。

需要注意的是，企业微信对消息推送有频率限制，避免对客户造成骚扰。根据官方文档，每个应用每天向同一个客户推送消息不能超过一定次数，具体限制取决于企业的认证状态和应用类型。

### 3. 事件回调机制

企业微信提供了事件回调机制，当客户添加员工、发送消息或删除员工时，企业微信服务器会向CRM系统发送回调通知。这使得系统可以实时响应客户行为，实现自动化营销。

根据企业微信官方文档[4]，主要的回调事件包括：**客户添加事件**（change_external_contact - add_external_contact），当客户扫码添加员工时触发，回调数据包含客户的external_userid、员工的userid、渠道标识state和欢迎语code；**客户删除事件**（change_external_contact - del_external_contact），当客户删除员工或员工删除客户时触发；**消息事件**（当客户发送消息时触发），回调数据包含消息内容、消息类型和消息ID。

CRM系统需要配置回调URL，并实现消息的解密和验证逻辑。企业微信使用AES加密算法对回调数据进行加密，系统需要使用配置的EncodingAESKey进行解密。同时，系统需要验证消息签名，确保回调请求来自企业微信服务器，防止恶意攻击。

---

## 技术架构设计

### 整体架构图

```
┌─────────────────────────────────────────────────────────────┐
│                         客户端（C端）                           │
│                                                               │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐      │
│  │  扫码添加     │  │  企业微信对话  │  │  接收消息推送  │      │
│  │  企业员工     │  │  咨询项目价格  │  │  预约提醒等   │      │
│  └──────────────┘  └──────────────┘  └──────────────┘      │
│                                                               │
└─────────────────────────────────────────────────────────────┘
                             ↕ HTTPS
┌─────────────────────────────────────────────────────────────┐
│                      企业微信服务器                            │
│                                                               │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐      │
│  │  客户联系API  │  │  消息推送API  │  │  事件回调    │      │
│  │  /add_contact │  │  /send_message│  │  Webhook     │      │
│  └──────────────┘  └──────────────┘  └──────────────┘      │
│                                                               │
└─────────────────────────────────────────────────────────────┘
                             ↕ HTTPS + AES加密
┌─────────────────────────────────────────────────────────────┐
│                    医美CRM系统（后端）                         │
│                                                               │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐      │
│  │  Access Token │  │  客户信息同步 │  │  消息处理    │      │
│  │  管理模块     │  │  标签管理模块 │  │  事件处理模块 │      │
│  └──────────────┘  └──────────────┘  └──────────────┘      │
│                                                               │
│  ┌──────────────────────────────────────────────────┐      │
│  │              MySQL 数据库                          │      │
│  │  wework_config | wework_contact_ways              │      │
│  │  wework_customers | wework_messages               │      │
│  │  wework_callback_logs                             │      │
│  └──────────────────────────────────────────────────┘      │
│                                                               │
└─────────────────────────────────────────────────────────────┘
                             ↕ tRPC API
┌─────────────────────────────────────────────────────────────┐
│                    医美CRM系统（前端）                         │
│                                                               │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐      │
│  │  企业微信配置 │  │  客户管理     │  │  消息推送    │      │
│  │  页面         │  │  页面         │  │  页面        │      │
│  └──────────────┘  └──────────────┘  └──────────────┘      │
│                                                               │
└─────────────────────────────────────────────────────────────┘
```

### 数据库设计

系统需要创建5张数据表来支持企业微信集成功能。**企业微信配置表**（wework_config）存储企业ID、Secret、AgentID、回调Token和EncodingAESKey，以及Access Token和过期时间。**「联系我」配置表**（wework_contact_ways）存储每个二维码的配置信息，包括config_id、类型、场景、有效期、渠道标识、二维码URL、员工ID列表和结束语配置。**企业微信客户表**（wework_customers）存储客户的企业微信信息，包括external_userid、关联的线索ID、姓名、头像、性别、unionid、添加方式、渠道标识、跟进人员工ID、备注、描述和标签。**消息推送记录表**（wework_messages）存储每条推送消息的记录，包括客户ID、消息类型、消息内容、发送状态、错误信息和发送时间。**事件回调日志表**（wework_callback_logs）存储所有回调事件的原始数据，用于调试和数据分析。

详细的数据表结构如下：

```sql
-- 企业微信配置表
CREATE TABLE wework_config (
  id INT PRIMARY KEY AUTO_INCREMENT,
  corp_id VARCHAR(255) NOT NULL COMMENT '企业ID',
  corp_secret VARCHAR(255) NOT NULL COMMENT '企业Secret',
  agent_id INT NOT NULL COMMENT '应用AgentID',
  token VARCHAR(255) NOT NULL COMMENT '回调Token',
  encoding_aes_key VARCHAR(255) NOT NULL COMMENT '回调EncodingAESKey',
  access_token TEXT COMMENT 'Access Token',
  access_token_expires_at BIGINT COMMENT 'Access Token过期时间',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- 「联系我」配置表
CREATE TABLE wework_contact_ways (
  id INT PRIMARY KEY AUTO_INCREMENT,
  config_id VARCHAR(255) NOT NULL UNIQUE COMMENT '企业微信返回的config_id',
  type TINYINT NOT NULL COMMENT '类型：1-单人, 2-多人',
  scene TINYINT NOT NULL COMMENT '场景：1-小程序, 2-二维码',
  is_temp BOOLEAN DEFAULT FALSE COMMENT '是否临时会话',
  expires_in INT COMMENT '二维码有效期（秒）',
  chat_expires_in INT COMMENT '会话有效期（秒）',
  state VARCHAR(255) COMMENT '渠道标识',
  qr_code TEXT COMMENT '二维码URL',
  user_ids TEXT COMMENT '员工ID列表（JSON数组）',
  conclusions TEXT COMMENT '结束语配置（JSON）',
  remark VARCHAR(255) COMMENT '备注',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_state (state)
);

-- 企业微信客户表
CREATE TABLE wework_customers (
  id INT PRIMARY KEY AUTO_INCREMENT,
  external_userid VARCHAR(255) NOT NULL UNIQUE COMMENT '企业微信客户ID',
  lead_id INT COMMENT '关联的线索ID',
  name VARCHAR(255) COMMENT '客户姓名',
  avatar TEXT COMMENT '头像URL',
  gender TINYINT COMMENT '性别：0-未知, 1-男, 2-女',
  unionid VARCHAR(255) COMMENT '微信unionid',
  type TINYINT COMMENT '类型：1-微信用户, 2-企业微信用户',
  add_way TINYINT COMMENT '添加方式',
  state VARCHAR(255) COMMENT '渠道标识',
  follow_user_id VARCHAR(255) COMMENT '跟进人员工ID',
  remark VARCHAR(255) COMMENT '备注',
  description TEXT COMMENT '描述',
  tags TEXT COMMENT '标签（JSON数组）',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_external_userid (external_userid),
  INDEX idx_lead_id (lead_id),
  INDEX idx_state (state)
);

-- 消息推送记录表
CREATE TABLE wework_messages (
  id INT PRIMARY KEY AUTO_INCREMENT,
  external_userid VARCHAR(255) NOT NULL COMMENT '客户ID',
  msgtype VARCHAR(50) NOT NULL COMMENT '消息类型：text/image/news等',
  content TEXT COMMENT '消息内容（JSON）',
  status VARCHAR(50) DEFAULT 'pending' COMMENT '状态：pending/sent/failed',
  error_msg TEXT COMMENT '错误信息',
  sent_at TIMESTAMP COMMENT '发送时间',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_external_userid (external_userid),
  INDEX idx_status (status)
);

-- 事件回调日志表
CREATE TABLE wework_callback_logs (
  id INT PRIMARY KEY AUTO_INCREMENT,
  event_type VARCHAR(100) NOT NULL COMMENT '事件类型',
  external_userid VARCHAR(255) COMMENT '客户ID',
  user_id VARCHAR(255) COMMENT '员工ID',
  state VARCHAR(255) COMMENT '渠道标识',
  raw_data TEXT COMMENT '原始数据（JSON）',
  processed BOOLEAN DEFAULT FALSE COMMENT '是否已处理',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_event_type (event_type),
  INDEX idx_processed (processed)
);
```

### 后端API设计

后端需要实现三个核心模块：**Access Token管理模块**、**客户联系API模块**和**事件回调处理模块**。

Access Token是调用企业微信API的凭证，有效期为7200秒（2小时）。系统需要实现自动刷新机制，在Token过期前提前1分钟刷新，避免API调用失败。Token管理模块应该实现单例模式，确保全局只有一个Token实例，避免并发刷新导致的问题。

客户联系API模块提供以下接口：**创建「联系我」**（createContactWay），接收前端传入的配置参数，调用企业微信API生成二维码，并将配置信息保存到数据库；**获取「联系我」列表**（listContactWays），从数据库查询已创建的二维码列表，支持按渠道标识筛选；**删除「联系我」**（deleteContactWay），调用企业微信API删除二维码，并从数据库中删除配置记录；**获取客户详情**（getCustomerDetail），调用企业微信API获取客户信息，并更新数据库中的客户记录；**发送消息**（sendMessage），接收前端传入的目标客户和消息内容，调用企业微信API发送消息，并记录推送日志。

事件回调处理模块负责接收企业微信服务器发送的回调通知，实现以下逻辑：**验证签名**，根据Token、Timestamp和Nonce计算签名，与企业微信传入的签名进行对比，确保请求来自企业微信服务器；**解密数据**，使用EncodingAESKey对回调数据进行AES解密；**解析XML**，将解密后的数据解析为JSON对象；**处理事件**，根据事件类型调用相应的处理函数，如客户添加事件会创建客户记录并触发自动化营销流程；**返回响应**，向企业微信服务器返回"success"，表示回调处理成功。

### 前端页面设计

前端需要开发4个页面来支持企业微信功能。**企业微信配置页面**（/dashboard/wework/config）提供表单输入企业ID、Secret、AgentID、回调Token和EncodingAESKey，并提供测试连接按钮，验证配置是否正确。**「联系我」管理页面**（/dashboard/wework/contact-ways）提供创建二维码的表单，包括类型、场景、有效期、渠道标识和结束语配置，以及二维码列表，支持预览、下载和删除操作。**客户管理页面**（/dashboard/customers）在现有页面基础上扩展，显示客户的企业微信信息，包括添加方式、渠道标识和跟进人，并提供同步客户信息和发送消息的按钮。**消息推送页面**（/dashboard/wework/messages）提供创建推送任务的表单，包括选择目标客户（支持按客户分层、心理类型、来源渠道筛选）、编辑消息内容（文本、图文、小程序卡片）、设置推送时间（立即或定时），以及推送记录列表，显示每条消息的发送状态和效果数据。

---

## 开发实施指南

### 准备工作

在开始开发之前，需要完成以下准备工作。首先，**注册企业微信**，访问 https://work.weixin.qq.com/ 注册企业微信账号，完成企业信息填写和管理员认证。其次，**企业认证**，企业微信的高级功能需要完成企业认证，认证费用为300元/年，认证后可以使用客户联系、消息推送等功能。第三，**创建自建应用**，登录企业微信管理后台，进入"应用管理" → "自建"，创建应用并获取AgentID和Secret，这两个参数是调用API的凭证。第四，**配置客户联系功能**，进入"客户联系" → "客户"，开启客户联系功能，并在"API"中配置可调用接口的应用，选择刚才创建的自建应用。最后，**配置回调URL**，在应用设置中配置回调URL（如 https://your-domain.com/api/wework/callback），配置Token和EncodingAESKey，并验证URL有效性。

### 开发步骤

开发工作分为5个步骤，预计总共需要12天完成。

**第一步：后端API集成（3天）**

创建 `server/lib/wework.ts` 文件，实现Access Token管理类。该类需要实现以下方法：`getAccessToken()`（获取Access Token，如果Token未过期则直接返回，否则调用企业微信API刷新）、`createContactWay(params)`（创建「联系我」）、`getContactWay(configId)`（获取「联系我」详情）、`deleteContactWay(configId)`（删除「联系我」）、`getExternalContact(externalUserId)`（获取客户详情）、`sendMessage(params)`（发送消息）。

创建 `server/routers/wework.ts` 文件，实现tRPC路由。该路由需要提供以下接口：`wework.config.save`（保存企业微信配置）、`wework.config.get`（获取企业微信配置）、`wework.config.test`（测试连接）、`wework.contactWays.create`（创建「联系我」）、`wework.contactWays.list`（获取「联系我」列表）、`wework.contactWays.delete`（删除「联系我」）、`wework.customers.sync`（同步客户信息）、`wework.customers.detail`（获取客户详情）、`wework.messages.send`（发送消息）、`wework.messages.list`（获取推送记录）。

创建 `server/routes.ts` 中的回调处理路由，实现POST `/api/wework/callback` 接口。该接口需要实现以下逻辑：验证签名、解密数据、解析XML、处理事件（客户添加、客户删除、消息）、返回响应。

**第二步：数据库设计和迁移（1天）**

创建数据库迁移文件，执行上述5张数据表的创建SQL。在 `server/db.ts` 中添加数据库操作函数：`createWeWorkConfig()`、`getWeWorkConfig()`、`updateWeWorkConfig()`、`createWeWorkContactWay()`、`getWeWorkContactWays()`、`deleteWeWorkContactWay()`、`createWeWorkCustomer()`、`getWeWorkCustomers()`、`updateWeWorkCustomer()`、`createWeWorkMessage()`、`getWeWorkMessages()`、`createWeWorkCallbackLog()`。

**第三步：前端页面开发（3天）**

创建 `client/src/pages/DashboardWeWorkConfig.tsx`，实现企业微信配置页面。该页面需要提供表单输入企业ID、Secret、AgentID、Token和EncodingAESKey，以及测试连接和保存按钮。

创建 `client/src/pages/DashboardWeWorkContactWays.tsx`，实现「联系我」管理页面。该页面需要提供创建按钮（打开配置表单弹窗）、二维码列表（表格展示，包括渠道标识、类型、场景、有效期、创建时间、操作按钮）、预览弹窗（显示二维码图片和配置信息）、下载按钮（下载二维码图片）、删除按钮（删除二维码）。

扩展 `client/src/pages/DashboardCustomers.tsx`，添加企业微信相关字段的显示（添加方式、渠道标识、跟进人），以及同步客户信息按钮和发送消息按钮。

创建 `client/src/pages/DashboardWeWorkMessages.tsx`，实现消息推送页面。该页面需要提供创建按钮（打开推送任务表单弹窗）、客户选择器（支持按客户分层、心理类型、来源渠道筛选）、消息编辑器（文本输入框、图文编辑器、小程序卡片配置）、预览窗口（实时预览消息效果）、发送按钮（立即发送或定时发送）、推送记录列表（表格展示，包括目标客户、消息类型、发送状态、发送时间、操作按钮）。

在 `client/src/components/DashboardLayout.tsx` 中添加导航菜单项，包括"企业微信配置"、"「联系我」管理"、"消息推送"。

**第四步：数据同步功能（2天）**

实现客户信息同步定时任务，每小时从企业微信获取客户列表，并更新数据库中的客户记录。实现对话记录同步（如果企业微信提供相关API）。实现标签同步，将CRM系统中的客户标签同步到企业微信。

**第五步：测试和优化（2天）**

测试「联系我」二维码生成功能，验证配置参数是否正确，二维码是否可以正常扫描。测试客户添加事件回调，验证回调数据是否正确解密和解析，客户记录是否正确创建。测试消息推送功能，验证消息是否正确发送，推送日志是否正确记录。测试数据同步功能，验证客户信息是否正确同步。优化错误处理和日志记录，确保系统稳定性。

### 部署配置

在生产环境部署时，需要完成以下配置。首先，**配置环境变量**，在 `.env` 文件中添加企业微信相关配置：`WEWORK_CORP_ID`、`WEWORK_CORP_SECRET`、`WEWORK_AGENT_ID`、`WEWORK_TOKEN`、`WEWORK_ENCODING_AES_KEY`。其次，**配置回调URL**，确保回调URL可以从公网访问，并且使用HTTPS协议。第三，**配置域名白名单**，在企业微信后台配置可信域名，用于小程序卡片和网页链接的跳转。最后，**配置IP白名单**（可选），在企业微信后台配置服务器IP白名单，提高安全性。

---

## 使用场景示例

### 场景一：客户咨询和预约

**业务流程：**

客户在小红书看到深圳妍美医疗美容门诊部发布的超皮秒祛斑项目推广文章，文章中包含一个企业微信二维码。客户对项目感兴趣，使用微信扫描二维码，系统提示"添加企业微信"，客户点击确认。

企业微信服务器向CRM系统发送客户添加事件回调，回调数据包含客户的external_userid和渠道标识"xiaohongshu"。CRM系统接收到回调后，自动调用企业微信API获取客户详情，包括姓名、头像、性别等信息。系统在数据库中创建客户记录，并打上"来源:小红书"的标签。

客户在企业微信中向企业员工发送消息："你好，我想咨询超皮秒祛斑项目，多少钱？"企业员工收到消息后，回复："您好！超皮秒祛斑项目采用先进的激光技术，可以精准击碎色素颗粒，温和祛除各类色斑。价格根据治疗面积和疗程不同，一般在3000-6000元之间。我们本周末有限时优惠活动，可以享受8折优惠。您方便的话，可以预约来店面诊，我们的专业医生会根据您的具体情况制定个性化方案。"

客户对价格和优惠活动感兴趣，询问如何预约。企业员工发送一个小程序卡片，客户点击后跳转到预约页面，填写预约信息（姓名、手机、预约时间）并提交。CRM系统自动创建预约记录，并向客户发送预约确认消息。

24小时后，临时会话到期，系统自动向客户发送结束语："感谢您的咨询！如需再次咨询，请扫描以下二维码添加我们的企业微信。点击下方链接可以查看更多项目介绍和客户案例：https://..."

**系统优势：**

整个流程中，客户无需安装额外应用，直接在企业微信中完成咨询和预约。系统自动记录客户信息和对话历史，方便后续跟进。通过渠道标识"xiaohongshu"，管理员可以统计小红书渠道的转化率，优化营销策略。临时会话模式确保了咨询的时效性，避免客户长期占用企业员工的时间。

### 场景二：营销活动推送

**业务流程：**

深圳妍美医疗美容门诊部计划在三八妇女节推出优惠活动，所有女性客户可以享受水光针项目8折优惠。管理员在CRM系统中创建营销活动推送任务。

首先，管理员在消息推送页面选择目标客户，筛选条件为：性别为女性、客户分层为A级或B级、30天内未消费。系统自动筛选出符合条件的200位客户。

其次，管理员编辑推送内容，选择图文消息类型，填写标题"三八妇女节特惠 | 水光针项目8折优惠"，描述"亲爱的女神们，三八妇女节即将到来，深圳妍美医疗美容门诊部为您准备了专属优惠！水光针项目原价2000元，现价1600元，名额有限，先到先得！点击查看详情并预约。"，上传活动海报图片，配置跳转链接为预约页面。

第三，管理员设置推送时间为3月7日上午10点，并点击"创建推送任务"按钮。系统保存推送任务到数据库，并在指定时间自动执行。

3月7日上午10点，系统调用企业微信API向200位目标客户批量发送图文消息。客户在企业微信中收到消息，点击查看活动详情和预约页面。系统记录每条消息的发送状态和客户的打开、点击行为。

推送完成后，管理员在推送记录列表中查看效果数据：发送成功200条，打开率65%（130人打开），点击率40%（80人点击预约页面），转化率15%（30人完成预约）。管理员根据数据分析，发现A级客户的转化率明显高于B级客户，决定在下次活动中重点针对A级客户推送。

**系统优势：**

通过精准筛选目标客户，避免了无效推送，提高了转化率。图文消息的形式比纯文本更具吸引力，提升了客户的打开和点击意愿。系统自动记录推送效果数据，为营销策略优化提供依据。批量推送功能大大节省了人工成本，一个管理员可以在几分钟内完成200位客户的推送任务。

### 场景三：自动化触发营销

**业务流程：**

深圳妍美医疗美容门诊部希望在客户生日时发送祝福和优惠券，提高客户满意度和复购率。管理员在CRM系统中配置自动化触发规则：触发条件为客户生日前7天，触发动作为发送企业微信消息。

系统每天凌晨1点执行定时任务，查询数据库中生日在未来7天内的客户。假设今天是3月1日，系统查询到客户李女士的生日是3月8日，符合触发条件。

系统自动生成推送消息，内容为："亲爱的李女士，您的生日即将到来，深圳妍美医疗美容门诊部全体员工祝您生日快乐！为了表达我们的祝福，特为您准备了生日专属优惠券：任意项目可享受9折优惠，有效期至3月31日。点击查看详情并预约。"

系统调用企业微信API向李女士发送消息，并记录触发日志。李女士收到消息后，感到非常惊喜和感动，决定在生日当天预约一次水光针项目。

3月8日，李女士到店消费，使用生日优惠券享受9折优惠。系统自动记录消费记录，并更新客户画像（最近消费时间、累计消费金额）。

**系统优势：**

自动化触发营销无需人工干预，系统会在合适的时间向合适的客户发送合适的消息。生日祝福和优惠券提升了客户的满意度和忠诚度，增加了复购率。系统自动记录触发日志和效果数据，管理员可以查看每次触发的转化情况，优化触发规则和消息内容。

---

## 常见问题解答

### Q1: 企业微信和个人微信有什么区别？

企业微信是腾讯专为企业打造的通讯工具，与个人微信相比具有以下区别。首先，**客户归属**，企业微信的客户数据归属于企业，即使员工离职，客户关系也不会流失；个人微信的客户归属于个人，员工离职后客户关系会流失。其次，**功能权限**，企业微信提供了丰富的客户管理功能，如客户标签、客户分组、客户统计等；个人微信的功能相对简单，主要用于个人社交。第三，**消息推送**，企业微信支持向客户主动推送营销消息，且不受个人微信的朋友圈广告限制；个人微信的消息推送受到严格限制，频繁发送营销消息可能被封号。最后，**数据统计**，企业微信提供了完善的数据统计功能，可以查看客户添加数量、会话次数、转化率等数据；个人微信没有数据统计功能。

### Q2: 临时会话模式和普通会话模式有什么区别？

临时会话模式是企业微信专为医疗行业设计的功能，与普通会话模式相比具有以下区别。首先，**会话有效期**，临时会话模式下客户添加后仅在指定时间内（如24小时）可以与企业员工进行会话，会话结束后无法继续发送消息；普通会话模式下客户添加后可以长期与企业员工进行会话。其次，**二维码有效性**，临时会话模式下二维码添加后立即失效，防止被恶意传播；普通会话模式下二维码可以重复使用。第三，**结束语**，临时会话模式支持配置结束语，会话结束时自动发送给客户；普通会话模式不支持结束语。最后，**适用场景**，临时会话模式适合一次性咨询场景，如医疗咨询、法律咨询等；普通会话模式适合长期客户关系维护场景，如销售跟进、售后服务等。

### Q3: 如何避免消息推送被限流？

企业微信对消息推送有频率限制，避免对客户造成骚扰。为了避免被限流，建议遵循以下最佳实践。首先，**控制推送频率**，每个应用每天向同一个客户推送消息不要超过3条，避免频繁打扰客户。其次，**精准筛选目标客户**，只向真正需要的客户推送消息，避免无效推送。第三，**优化推送内容**，确保推送内容对客户有价值，避免发送纯广告内容。第四，**使用定时推送**，避免在客户休息时间（如晚上10点后、早上8点前）推送消息。最后，**监控推送效果**，定期查看推送数据（打开率、点击率、转化率），优化推送策略。

### Q4: 如何保证回调URL的安全性？

企业微信的回调URL是系统接收事件通知的入口，安全性至关重要。为了保证回调URL的安全性，建议采取以下措施。首先，**使用HTTPS协议**，确保回调数据在传输过程中被加密，防止被窃听或篡改。其次，**验证签名**，企业微信会在回调请求中附带签名参数，系统需要根据Token、Timestamp和Nonce计算签名，与企业微信传入的签名进行对比，确保请求来自企业微信服务器。第三，**解密数据**，企业微信使用AES加密算法对回调数据进行加密，系统需要使用配置的EncodingAESKey进行解密。第四，**限制访问IP**，在服务器防火墙中配置IP白名单，只允许企业微信服务器的IP访问回调URL。最后，**记录日志**，将所有回调请求记录到数据库中，方便调试和审计。

### Q5: 企业微信和微信小程序可以同时使用吗？

可以同时使用，两者并不冲突，而是互补的关系。企业微信适合客户咨询和关系维护场景，微信小程序适合在线预约和内容展示场景。建议的使用策略是：在小红书、抖音等公域平台推广时，同时提供企业微信二维码和小程序码，客户可以根据自己的需求选择。如果客户想要快速咨询，可以扫描企业微信二维码添加企业员工；如果客户想要在线预约或查看项目详情，可以扫描小程序码进入小程序。在企业微信中，企业员工可以向客户发送小程序卡片，引导客户在小程序中完成预约和支付。在小程序中，可以提供"联系客服"按钮，引导客户添加企业微信，建立长期联系。通过企业微信和微信小程序的结合，可以实现公域引流、私域沉淀、长期转化的完整闭环。

---

## 参考资料

[1] 企业微信开发者中心. (2025). 客户联系「联系我」管理. Retrieved from https://developer.work.weixin.qq.com/document/path/92228

[2] 企业微信开发者中心. (2025). 获取客户详情. Retrieved from https://developer.work.weixin.qq.com/document/path/92114

[3] 企业微信开发者中心. (2025). 发送应用消息. Retrieved from https://developer.work.weixin.qq.com/document/path/90236

[4] 企业微信开发者中心. (2025). 回调配置. Retrieved from https://developer.work.weixin.qq.com/document/path/90930

---

**文档结束**

如有任何问题或需要进一步的技术支持，请联系开发团队。
